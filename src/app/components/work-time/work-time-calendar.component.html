<div class="wtc-container">
  <div class="wtc-layout">
    <aside class="wtc-sidebar">
      <div class="wtc-title">Ewidencja czasu</div>
      <nav class="wtc-nav">
        <a routerLink="/work-time" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <span class="icon">üìÖ</span>
          Widok miesiƒÖca
        </a>
        <a routerLink="/work-time/config" routerLinkActive="active">
          <span class="icon">‚öôÔ∏è</span>
          Konfiguracja
        </a>
        <a routerLink="/work-time-records" routerLinkActive="active">
          <span class="icon">üóÇÔ∏è</span>
          Moja ewidencja
        </a>
        <a routerLink="/leave-requests" routerLinkActive="active">
          <span class="icon">üìù</span>
          Wnioski
        </a>
        @if (canSeeOthers()) {
          <a routerLink="/admin/work-time" routerLinkActive="active">
            <span class="icon">üóìÔ∏è</span>
            Przelicz dni
          </a>
        }
      </nav>

      <div class="wtc-sidebar-card">
        <div class="label">Aktualny tryb</div>
        @if (mode()) {
          <div class="pill pill-mode">{{ mode() }}</div>
        } @else {
          <span class="muted">(brak konfiguracji)</span>
        }
      </div>
    </aside>

    <main class="wtc-main">
      <div class="header">
        <h2>Ewidencja czasu pracy ‚Äî miesiƒÖc</h2>
        <div class="period-picker">
          <button (click)="prevMonth()">‚Üê</button>
          <button (click)="today()">Dzi≈õ</button>
          <div class="period">{{ period() }}</div>
          <button (click)="nextMonth()">‚Üí</button>
        </div>
        @if (canSeeOthers()) {
          <div class="controls">
            <label>
              Pracownik:
              <input list="employees" (change)="onUserFilterChange()" [(ngModel)]="userIdFilter" placeholder="Wpisz ID lub wybierz" />
              <datalist id="employees">
                @for (e of employees(); track e.id) {
                  <option [value]="e.id">{{ employeeLabel(e) }}</option>
                }
              </datalist>
            </label>
          </div>
        }
      </div>

      <div class="info-bar">
        @if (mode()) {
          <span class="pill pill-mode">Tryb: {{ mode() }}</span>
        } @else {
          <span class="muted">Tryb: nieznany (konf. nieza≈Çadowana)</span>
        }
        <span class="spacer"></span>
        @if (monthTotals(); as t) {
          <span class="summary">Efektywne: <strong>{{ t.effective | number:'1.2-2' }} h</strong></span>
          <span class="summary">Manual: {{ t.standard | number:'1.2-2' }} + {{ t.overtime | number:'1.2-2' }} h</span>
        }
      </div>

      @if (loading()) {
        <div class="loading">≈Åadowanie...</div>
      }
      @if (error()) {
        <div class="error">{{ error() }}</div>
      }

      @if (!loading() && !error()) {
      <table class="days">
        <thead>
          <tr>
            <th>Data</th>
            <th>Plan</th>
            <th>Punch</th>
            <th>Manual</th>
            <th>Efektywne</th>
            <th>Uwagi</th>
            <th>Akcje</th>
          </tr>
        </thead>
        <tbody>
          @for (d of days(); track d.workDate) {
          <tr (click)="openDay(d)" class="row-click">
            <td>
              <span [class.leave]="d.leaveDay">{{ d.workDate }}</span>
              @if (d.leaveDay) {
                <span class="pill">Urlop {{ d.leaveType || '' }}</span>
              }
            </td>
            <td>
              @if (d.scheduledStartTime && d.scheduledEndTime) {
                <ng-container>{{ d.scheduledStartTime }}‚Äì{{ d.scheduledEndTime }}</ng-container>
              } @else {
                <span class="muted">‚Äî</span>
              }
            </td>
            <td>
              @if (d.punchInTime || d.punchOutTime) {
                <ng-container>
                  @if (d.punchInTime) { <span>IN {{ d.punchInTime }}</span> }
                  @if (d.punchOutTime) { <span>OUT {{ d.punchOutTime }}</span> }
                </ng-container>
              } @else {
                <span class="muted">‚Äî</span>
              }
            </td>
            <td>
              @if ((d.standardHours ?? 0) + (d.overtimeHours ?? 0) > 0) {
                <ng-container>
                  {{ d.standardHours || 0 | number:'1.2-2' }} + {{ d.overtimeHours || 0 | number:'1.2-2' }} h
                </ng-container>
              } @else {
                <span class="muted">‚Äî</span>
              }
            </td>
            <td>
              @if (totalHours(d) != null) {
                <span>{{ totalHours(d) | number:'1.2-2' }} h</span>
              } @else {
                <span class="muted">‚Äî</span>
              }
            </td>
            <td>
              @if (!d.note) { <span class="muted">‚Äî</span> }
              @if (d.note) { <span>{{ d.note }}</span> }
              @if (d.editable) { <span class="pill pill-edit">Edytowalne</span> }
            </td>
            <td class="actions" (click)="$event.stopPropagation()">
              @if (canPunchInRow(d)) { <button (click)="rowPunchIn(d)">Punch In</button> }
              @if (canPunchOutRow(d)) { <button (click)="rowPunchOut(d)">Punch Out</button> }
            </td>
          </tr>
          }
        </tbody>
      </table>
      }
    </main>
  </div>
</div>
